<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="theme-color" content="#0a0a0f" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="description" content="Калькулятор цены за единицу товара с функцией сравнения" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self';
                   script-src 'self';
                   style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
                   font-src 'self' https://fonts.gstatic.com;
                   connect-src 'self';
                   img-src 'self' data:;"
    />
    <title>ЦенаЗа1 — Сравни и сэкономь</title>
    <link rel="icon" href="icons/icon-32.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="icons/icon-192.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;500;600;700&family=Manrope:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="bg-gradient"></div>

    <div class="container">
      <header>
        <div class="header-left">
          <div class="logo">ЦенаЗа1</div>
          <div class="tagline">Сравни цены — выбери лучшее</div>
        </div>
        <div class="theme-switcher">
          <button class="theme-btn" data-theme="light" title="Светлая тема">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
          </button>
          <button class="theme-btn" data-theme="dark" title="Тёмная тема">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </button>
          <button class="theme-btn" id="helpBtn" title="Помощь">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
          </button>
        </div>
      </header>

      <div class="calc-card">
        <div class="calc-title">
          <div class="calc-title-icon">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="var(--accent-primary)"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="12" y1="1" x2="12" y2="23"></line>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
          </div>
          Добавить товар
        </div>

        <div class="input-group full">
          <label class="input-label">Название товара</label>
          <input
            type="text"
            class="input-field"
            id="productName"
            placeholder="Например: Молоко Простоквашино"
          />
        </div>

        <div class="input-row">
          <div class="input-group">
            <label class="input-label">Цена (₽)</label>
            <input
              type="number"
              class="input-field"
              id="price"
              placeholder="150"
              inputmode="decimal"
            />
          </div>
          <div class="input-group">
            <label class="input-label">Количество</label>
            <input
              type="number"
              class="input-field"
              id="quantity"
              placeholder="100"
              inputmode="decimal"
            />
          </div>
        </div>

        <label class="input-label">Единица измерения</label>
        <div class="unit-selector">
          <button class="unit-btn active" data-unit="г" data-large="кг" data-factor="1000">
            граммы
          </button>
          <button class="unit-btn" data-unit="мл" data-large="л" data-factor="1000">мл</button>
          <button class="unit-btn" data-unit="шт" data-large="100 шт" data-factor="100">
            штуки
          </button>
        </div>

        <button class="add-btn" id="addProduct">
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
          >
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Добавить к сравнению
        </button>
      </div>

      <div class="results-section" id="resultsSection" style="display: none">
        <div class="section-header">
          <div class="section-title">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="var(--accent-primary)"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="20" x2="18" y2="10"></line>
              <line x1="12" y1="20" x2="12" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
            Сравнение
            <span class="item-count" id="itemCount">0</span>
          </div>
          <button class="clear-all" id="clearAll">Очистить всё</button>
        </div>

        <div class="sort-toggle">
          <button class="sort-btn active" data-sort="price">По цене ↑</button>
          <button class="sort-btn" data-sort="added">Новые сверху</button>
        </div>

        <div class="products-list" id="productsList"></div>
      </div>

      <div class="empty-state" id="emptyState">
        <svg
          class="empty-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="20" cy="21" r="1"></circle>
          <path d="m1 1 4 4 2.68 11.63a2 2 0 0 0 2 1.37h9.72a2 2 0 0 0 2-1.63L23 6H6"></path>
        </svg>
        <div class="empty-title">Пока пусто</div>
        <div class="empty-text">Добавьте товары для сравнения,<br />чтобы найти лучшую цену</div>
      </div>

      <!-- History Section -->
      <div class="history-section" id="historySection">
        <div class="history-header">
          <div class="history-title">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="var(--accent-primary)"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            История сравнений
          </div>
          <button class="save-session-btn" id="saveSessionBtn">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            Сохранить
          </button>
        </div>
        <div class="history-list" id="historyList">
          <div class="history-empty">Сохранённых сравнений пока нет</div>
        </div>
      </div>
    </div>

    <!-- Save Modal -->
    <div class="modal-overlay" id="saveModal">
      <div class="modal">
        <div class="modal-title">Сохранить сравнение</div>
        <input
          type="text"
          class="modal-input"
          id="sessionNameInput"
          placeholder="Название, например: Молоко в Пятёрочке"
        />
        <div class="modal-buttons">
          <button class="modal-btn cancel" id="modalCancel">Отмена</button>
          <button class="modal-btn confirm" id="modalConfirm">Сохранить</button>
        </div>
      </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-overlay confirm-modal" id="confirmModal">
      <div class="modal">
        <div class="modal-title" id="confirmTitle">Подтверждение</div>
        <div class="modal-text" id="confirmText">Вы уверены?</div>
        <div class="modal-buttons">
          <button class="modal-btn cancel" id="confirmCancel">Отмена</button>
          <button class="modal-btn danger" id="confirmOk">Удалить</button>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="install-banner" id="installBanner">
      <div class="install-text">
        <div class="install-title">Установить приложение</div>
        <div class="install-desc">Добавьте на главный экран</div>
      </div>
      <button class="install-btn" id="installBtn">Установить</button>
      <button class="install-close" id="installClose">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
